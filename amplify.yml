version: 1

frontend:
  phases:
    preBuild:
      commands:
        - npm ci

    build:
      commands:
        # ðŸ”´ Fail fast if public auth env vars are missing
        - test -n "$NEXT_PUBLIC_userName"
        - test -n "$NEXT_PUBLIC_password"

        # ðŸ§¹ Clean old env files
        - rm -f .env .env.production

        # âœ… Bake public env vars into Next.js
        - echo "NEXT_PUBLIC_userName=$NEXT_PUBLIC_userName" >> .env
        - echo "NEXT_PUBLIC_password=$NEXT_PUBLIC_password" >> .env

        # Next.js reads .env.production in prod
        - cp .env .env.production

        # Build
        - npm run build

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
